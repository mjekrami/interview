templates:
  - "templates/postgres.template.yml"
  - "templates/redis.template.yml"

params:
  db_default_text_search_config: "pg_catalog.english"

env:
  # ensure locale exists in container
  LC_ALL: en_US.UTF-8
  LANG: en_US.UTF-8
  LANGUAGE: en_US.UTF-8

volumes:
  - volume:
      host: /var/discourse/shared/data
      guest: /shared
  - volume:
      host: /var/discourse/shared/data/log/var-log
      guest: /var/log

# TODO: SOME_SECRET to a password for the discourse user
hooks:
  after_postgres:
    - exec:
        stdin: |
          alter user discourse with password 'SOME_SECRET';
        cmd: su - postgres -c 'psql discourse'
        raise_on_fail: false
